name: Apply accounts
description: Apply accounts

inputs:
  AWS_REGION:
    required: true
    description: "AWS region"
    default: "eu-central-1"

  TF_VERSION:
    description: "Terraform Version"
    required: true

  NODE_VERSION:
    description: "NodeJS Version to be configured"
    required: true

  TF_WORKSPACE:
    description: "Name of the Terraform Workspace"
    required: true

runs:
  using: "composite"
  steps:
    - name: Node.JS - Setup
      uses: actions/setup-node@v3
      with:
        node-version: ${{ inputs.NODE_VERSION }}

    - name: Terraform - Setup
      uses: hashicorp/setup-terraform@v3
      with:
        terraform_version: "1.9.2"

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        role-to-assume: arn:aws:iam::831308554080:role/cawe/cawe-developer
        role-skip-session-tagging: true
        aws-region: ${{ inputs.AWS_REGION }}

    - name: Terraform - Init
      id: init
      shell: bash
      run: terraform init
      working-directory: ${{ inputs.TF_WORKSPACE }}

    - name: Terraform - Select Workspace
      id: workspace
      shell: bash
      working-directory: ${{ inputs.TF_WORKSPACE }}
      run: terraform workspace select ${{ inputs.TF_WORKSPACE }}

    - name: list directory
      id: list
      shell: bash
      working-directory: ${{ inputs.TF_WORKSPACE }}
      run: ls -l

    - name: Terraform - Apply - Transit
      #if: inputs.TF_WORKSPACE == '932595925475'
      id: apply
      shell: bash
      working-directory: ${{ inputs.TF_WORKSPACE }}
      run: terraform apply plan-${{ inputs.TF_WORKSPACE }}.tfplan
#    - name: Terraform - Apply - Advanced
#      if: inputs.TF_WORKSPACE == '092228957173'
#      id: apply_adv
#      shell: bash
#      working-directory: ${{ inputs.TF_WORKSPACE }}
#      run: terraform apply ../92228957173/plan-${{ inputs.TF_WORKSPACE }}.tfplan

