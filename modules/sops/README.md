### Install SOPS
In MacOS SOPS is easily installed with homebrew:
```
 brew install sops
```
### Write or edit source plain text files

Now we need the files with the values to be cyphered, this module accepts simples json files with the following  format:

```json
{
   "key1": "value1",
   "key2": "value2"
}
```

File names will be **_secrets.dev.json_**, **_secrets.int.json_**, **_secrets.prd.json_**, related to each environment.
Please handle these file outside any git repo and in a secure location. 

### Generate  SOPS cyphered  files:

Having the source files we only need to run SOPS against they.

The generic command will be the following:
```
sops --encrypt --kms "ksm_arn+role_arn"  secrets.dec.json > secrets.enc.json
 ```
For dev:
```
sops --encrypt  --kms arn:aws:kms:eu-central-1:092228957173:key/b56af9e9-5be5-4668-b006-e40dae7e19a9+arn:aws:iam::092228957173:role/cawe/cawe-developer secrets.dev.json > ../cawe-core/092228957173/secrets.dev.json
```
For int:
```
 sops --encrypt  --kms arn:aws:kms:eu-central-1:500643607194:key/21520951-9651-4c94-b080-8643c8dc4c03+arn:aws:iam::500643607194:role/cawe/cawe-developer secrets.int.json >../cawe-core/500643607194/secrets.int.json
```
For int-orbit:
```
 sops --encrypt  --kms arn:aws:kms:eu-central-1:051351247033:key/4d339dce-da3d-437b-a425-c71c0bf0a3d7+arn:aws:iam::051351247033:role/cawe/cawe-developer secrets.int.json >../cawe-core/500643607194/secrets.int.json
```

For prd:
```
  sops --encrypt  --kms arn:aws:kms:eu-central-1:810674048896:key/36f685fb-71ce-4cd8-b550-8950db698b4e+arn:aws:iam::810674048896:role/cawe/cawe-developer secrets.prd.json >../cawe-core/810674048896/secrets.prd.json 

```
For prd-B:
```
  sops --encrypt  --kms arn:aws:kms:eu-central-1:339712784782:key/33838bcf-edd7-47a6-9b66-988e0e3a0365+arn:aws:iam::339712784782:role/cawe/cawe-developer secrets.prd.json >../cawe-core/EMEA-PRDB-advanced/secrets.prd.json 

```
For prd-orbit:
```
  sops --encrypt  --kms arn:aws:kms:eu-central-1:641068916226:key/32348e38-8ef5-4069-9660-5f8704a9ac7a+arn:aws:iam::641068916226:role/cawe/cawe-developer secrets.prd.json >../cawe-core/810674048896/secrets.prd.json 

```
Here we have to pass  the desired KMS Key ARN and also the Role ARN, using the + operator. This is the only way for Terraform provider to know which Role to use.

### Check generated files 

To decrypt the previous generated file we don't need to give any KMS values, these values are already appended to the file generated by SOPS

```
sops --decrypt  secrets.enc.json
````

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_sops"></a> [sops](#requirement\_sops) | 1.0.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_sops"></a> [sops](#provider\_sops) | 1.0.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [sops_file.sops](https://registry.terraform.io/providers/carlpett/sops/1.0.0/docs/data-sources/file) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_input_type"></a> [input\_type](#input\_input\_type) | (Optional) The provider will use the file extension to determine how to unmarshal the data. If your file does not have the usual extension, set this argument to yaml or json accordingly, or raw if the encrypted data is encoded differently. | `any` | `null` | no |
| <a name="input_secret_file"></a> [secret\_file](#input\_secret\_file) | The secret file to be used to decrypt the secret | `string` | n/a | yes |
| <a name="input_secret_key"></a> [secret\_key](#input\_secret\_key) | The JSON key where the secret is stored in the secret file. Not needed if input\_type is raw | `string` | `null` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_secret_content"></a> [secret\_content](#output\_secret\_content) | n/a |
<!-- END_TF_DOCS -->
